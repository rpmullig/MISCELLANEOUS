direction: right
grid-rows: 3

# -------------------- USER LAYER --------------------
UserLayer: {
  direction: right
  style.fill: "#f3e5f5"
  grid-rows: 1

  Broker: {
    label: "Broker"
    shape: person
    style.fill: "#d1c4e9"
  }

  SSC: {
    label: "SSC"
    shape: person
    style.fill: "#d1c4e9"
  }

  UW: {
    label: "UW"
    shape: person
    style.fill: "#d1c4e9"
  }

  COE: {
    label: "CoE"
    shape: person
    style.fill: "#d1c4e9"
  }
}

# -------------------- PROCESS LAYER --------------------
ProcessFlow: {
  grid-columns: 3
  direction: right
  style.fill: "#e6f0ff"

  PreReservation: {
    direction: right
    style.fill: "#e6f0ff"

    InboxSweep: {
      label: "Inbox Sweep\n(System: ImageRight)"
      style.fill: "#f2d9e6"
    }

    EmailPull: {
      label: "Email & Docs Pulled\n(System: UWA)"
      style.fill: "#cce5ff"
    }

    DocClassification: {
      label: "Doc Classification\n(System: UWA)"
      style.fill: "#cce5ff"
    }

    FieldExtraction: {
      label: "Field Extraction\n(System: UWA)"
      style.fill: "#cce5ff"
    }

    ExternalEnrichment: {
      label: "External Risk Enrichment\n(Google, SpotCrime, Yelp)"
      style.fill: "#ccffe6"
    }

    GLMSDecisionCheck: {
      label: "Check if GLMS Needed\n(TIV > \$30M or CAT)"
      style.fill: "#f2ffe6"
    }

    LowConfidence: {
      label: "Low Confidence Flag\n(System: UWA)"
      style.fill: "#cce5ff"
    }

    SSCReview: {
      label: "SSC Manual Review\n(System: SSC)"
      style.fill: "#e6ccff"
    }

    NGEReservation: {
      label: "NGE Reservation & Clearance\n(System: NGE)"
      style.fill: "#ffe6cc"
    }

    WWIPPrefill: {
      label: "WWIP Pre-Fill\n(System: WWIP)"
      style.fill: "#ffffcc"
    }
  }

  Reservation: {
    direction: right
    style.fill: "#f9f5d7"

    SSCValidation: {
      label: "SSC Assignment & Finalization\n(System: WWIP)"
      style.fill: "#ffffcc"
    }

    ReadyForUW: {
      label: "Status: Ready for UW\n(System: WWIP)"
      style.fill: "#ffffcc"
    }
  }

  PostReservation: {
    direction: right
    style.fill: "#e8fce8"

    Prioritization: {
      label: "Submission Prioritization\n(System: UWA)"
      style.fill: "#cce5ff"
    }

    FastTrackCheck: {
      label: "Fast Track Eligibility\n(System: UWA)"
      style.fill: "#cce5ff"
    }

    UWAConsole: {
      label: "UWA Console\n(System: UWA)"
      style.fill: "#cce5ff"
    }

    GLMSHandoff: {
      label: "GLMS Handoff\n(System: GLMS)"
      style.fill: "#d9f2d9"
    }

    GLMSResults: {
      label: "GLMS Results → WWIP\n(System: WWIP)"
      style.fill: "#ffffcc"
    }

    WorksheetGen: {
      label: "Worksheet Auto-Generated\n(System: UWA)"
      style.fill: "#cce5ff"
    }

    FollowUpReingest: {
      label: "Re-Ingest Follow-ups\n(System: UWA)"
      style.fill: "#cce5ff"
    }

    UWReview: {
      label: "UW Final Review & Quote\n(System: WWIP)"
      style.fill: "#cce5ff"
    }
  }
}

# -------------------- DATA LAYER --------------------
DataLayer: {
  direction: right
  style.fill: "#d9e8fb"
  grid-rows: 1

  OntologyLayer: {
    label: "Ontology Layer\n(Palantir AIP / Foundry)"
    shape: cylinder
    style.fill: "#fbe9e7"
  }

  GDMS: {
    label: "GDMS\n(Document Repository)"
    shape: cylinder
    style.fill: "#fbe9e7"
  }

  MDM: {
    label: "MDM\n(Master Data Mgmt)"
    shape: cylinder
    style.fill: "#fbe9e7"
  }

  RDM: {
    label: "RDM\n(Reference Data Mgmt)"
    shape: cylinder
    style.fill: "#fbe9e7"
  }

  NGPLS: {
    label: "NGPLS\n(Producer Licensing)"
    shape: cylinder
    style.fill: "#fbe9e7"
  }

  GDW: {
    label: "GDW\n(Global Data Warehouse)"
    shape: cylinder
    style.fill: "#fbe9e7"
  }

  ExternalSources: {
    label: "External Data APIs\n(Google, DOL, Pitchbook, SpotCrime)"
    shape: cylinder
    style.fill: "#fbe9e7"
  }

  Textract: {
    label: "AWS Textract\n(OCR from Docs)"
    shape: rectangle
    style.fill: "#fbe9e7"
  }

  Titan: {
    label: "Titan Embedding\n(Vector Generation)"
    shape: rectangle
    style.fill: "#fbe9e7"
  }

  Claude: {
    label: "Claude LLM\n(Synthesis & Q/A)"
    shape: rectangle
    style.fill: "#fbe9e7"
  }
}

# -------------------- ARROWS with ACTIONS --------------------
# DataLayer Integration
DataLayer.Textract -> DataLayer.Titan: "Extract → Embed"
DataLayer.Titan -> DataLayer.Claude: "Embed → Summarize"
DataLayer.Claude -> DataLayer.OntologyLayer: "Store in Ontology"
DataLayer.GDMS -> ProcessFlow.PreReservation.EmailPull: "Send parsed docs"
DataLayer.MDM -> ProcessFlow.PreReservation.NGEReservation: "Send D&B Match"
DataLayer.RDM -> ProcessFlow.PreReservation.NGEReservation: "PUC Mapping"
DataLayer.NGPLS -> ProcessFlow.PreReservation.NGEReservation: "Validate Producer"
DataLayer.GDW -> ProcessFlow.PostReservation.GLMSResults: "Pull Prior Bound Info"
DataLayer.ExternalSources -> ProcessFlow.PreReservation.ExternalEnrichment: "Augment with External Data"
DataLayer.OntologyLayer -> ProcessFlow.PreReservation.FieldExtraction: "Return Enriched Fields"

# Process Layer Flow
ProcessFlow.PreReservation.InboxSweep -> ProcessFlow.PreReservation.EmailPull: "Trigger on broker email"
ProcessFlow.PreReservation.EmailPull -> ProcessFlow.PreReservation.DocClassification: "Extract attachments"
ProcessFlow.PreReservation.DocClassification -> ProcessFlow.PreReservation.FieldExtraction: "Classify and pass to GenAI"
ProcessFlow.PreReservation.FieldExtraction -> ProcessFlow.PreReservation.ExternalEnrichment: "Field output → Enrichment"
ProcessFlow.PreReservation.ExternalEnrichment -> ProcessFlow.PreReservation.GLMSDecisionCheck: "TIV/Peril Assessment"
ProcessFlow.PreReservation.GLMSDecisionCheck -> ProcessFlow.PreReservation.LowConfidence: "If confidence < threshold"
ProcessFlow.PreReservation.LowConfidence -> ProcessFlow.PreReservation.SSCReview: "Send to SSC Queue"
ProcessFlow.PreReservation.GLMSDecisionCheck -> ProcessFlow.PreReservation.NGEReservation: "If confidence high"
ProcessFlow.PreReservation.NGEReservation -> ProcessFlow.PreReservation.WWIPPrefill: "Submit to WWIP"
ProcessFlow.PreReservation.WWIPPrefill -> ProcessFlow.Reservation.SSCValidation: "Kick off SSC review"
ProcessFlow.Reservation.SSCValidation -> ProcessFlow.Reservation.ReadyForUW: "Assign UW"
ProcessFlow.Reservation.ReadyForUW -> ProcessFlow.PostReservation.Prioritization: "Trigger prioritization"
ProcessFlow.PostReservation.Prioritization -> ProcessFlow.PostReservation.FastTrackCheck: "Score + Eligibility Check"
ProcessFlow.PostReservation.FastTrackCheck -> ProcessFlow.PostReservation.UWAConsole: "Display in Console"
ProcessFlow.PostReservation.UWAConsole -> ProcessFlow.PostReservation.GLMSHandoff: "Trigger if TIV > \$30M or CAT"
ProcessFlow.PostReservation.GLMSHandoff -> ProcessFlow.PostReservation.GLMSResults: "Push to GLMS API"
ProcessFlow.PostReservation.GLMSResults -> ProcessFlow.PostReservation.WorksheetGen: "Auto-fill Worksheet"
ProcessFlow.PostReservation.UWAConsole -> ProcessFlow.PostReservation.FollowUpReingest: "Capture Follow-up"
ProcessFlow.PostReservation.FollowUpReingest -> ProcessFlow.PreReservation.FieldExtraction: "Re-run Extraction"
ProcessFlow.PostReservation.UWAConsole -> ProcessFlow.PostReservation.UWReview: "Manual UW Final Review"

# User Flow Arrows
UserLayer.Broker -> ProcessFlow.PreReservation.InboxSweep: "Send Submission Email"
UserLayer.SSC -> ProcessFlow.PreReservation.SSCReview: "Review Low-Confidence Case"
UserLayer.SSC -> ProcessFlow.Reservation.SSCValidation: "Finalize Fields in WWIP"
UserLayer.UW -> ProcessFlow.PostReservation.UWAConsole: "Open Task Console"
UserLayer.UW -> ProcessFlow.PostReservation.UWReview: "Finalize Indication & Quote"
UserLayer.UW -> ProcessFlow.PostReservation.GLMSHandoff: "Initiate GLMS Request"
UserLayer.COE -> ProcessFlow.PostReservation.GLMSResults: "Upload Results to WWIP"
