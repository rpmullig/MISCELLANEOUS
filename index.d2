direction: right
grid-rows: 3

# -------------------- ONTOLOGY / EMBEDDING LAYER --------------------
OntologyLayer: {
  direction: right
  grid-columns: 4
  style.fill: "#f3e5f5"

  Textract: {
    label: "AWS Textract\n(OCR)"
    shape: rectangle
    style.fill: "#f8bbd0"
  }

  Titan: {
    label: "Titan Embedding\n(Vectorize)"
    shape: rectangle
    style.fill: "#f8bbd0"
  }

  Claude: {
    label: "Claude LLM\n(Summarize, Synthesize)"
    shape: rectangle
    style.fill: "#f8bbd0"
  }

  VectorStore: {
    label: "Ontology Vector Store"
    shape: cylinder
    style.fill: "#ce93d8"
  }
}

# -------------------- PROCESS FLOW --------------------
ProcessFlow: {
  direction: right
  style.fill: "#e0f7fa"

  BrokerActor: {
    label: "Broker"
    shape: person
    style.fill: "#ffcc80"
  }

  SSActor: {
    label: "SSC"
    shape: person
    style.fill: "#ce93d8"
  }

  UWActor: {
    label: "UW"
    shape: person
    style.fill: "#90caf9"
  }

  COEActor: {
    label: "CoE"
    shape: person
    style.fill: "#b39ddb"
  }

  BrokerDocs: {
    label: "Broker Submission\n(SoV, Loss Runs, etc)"
    shape: document
    style.fill: "#ffecb3"
  }

  PreReservation: {
    direction: right
    style.fill: "#e6f0ff"

    InboxSweep: {
      label: "Inbox Sweep\n(ImageRight)"
      style.fill: "#f2d9e6"
    }

    EmailPull: {
      label: "Pull Emails & Attachments\n(UWA)"
      style.fill: "#cce5ff"
    }

    DocClassification: {
      label: "Classify Docs\n(UWA)"
      style.fill: "#cce5ff"
    }

    FieldExtraction: {
      label: "Field Extraction\n(UWA)"
      style.fill: "#cce5ff"
    }

    ExternalEnrichment: {
      label: "External Risk Enrichment"
      style.fill: "#ccffe6"
    }

    GLMSDecisionCheck: {
      label: "Check GLMS Need\n(TIV > \$30M or CAT)"
      style.fill: "#f2ffe6"
    }

    LowConfidence: {
      label: "Low Confidence Flag"
      style.fill: "#ffccbc"
    }

    SSCReview: {
      label: "Manual Review\n(SSC)"
      style.fill: "#e1bee7"
    }

    NGEReservation: {
      label: "NGE Reservation"
      style.fill: "#ffe0b2"
    }

    WWIPPrefill: {
      label: "WWIP Pre-Fill"
      style.fill: "#ffffcc"
    }
  }

  Reservation: {
    direction: right
    style.fill: "#fff9c4"

    SSCValidation: {
      label: "SSC Finalize Fields\nAssign UW"
      style.fill: "#fff59d"
    }

    ReadyForUW: {
      label: "Ready for UW\n(Trigger Task Queue)"
      style.fill: "#fff176"
    }
  }

  PostReservation: {
    direction: right
    style.fill: "#e8f5e9"

    Prioritization: {
      label: "Score & Prioritize\n(UWA Rules Engine)"
      style.fill: "#c8e6c9"
    }

    FastTrackCheck: {
      label: "Fast Track Logic"
      style.fill: "#aed581"
    }

    UWAConsole: {
      label: "UWA Console View"
      style.fill: "#a5d6a7"
    }

    GLMSHandoff: {
      label: "GLMS Handoff"
      style.fill: "#dcedc8"
    }

    GLMSResults: {
      label: "GLMS Results Ingest"
      style.fill: "#f0f4c3"
    }

    WorksheetGen: {
      label: "Generate Workup"
      style.fill: "#e6ee9c"
    }

    FollowUpReingest: {
      label: "Follow-up Reingestion"
      style.fill: "#dce775"
    }

    UWReview: {
      label: "Final UW Review & Quote"
      style.fill: "#c5e1a5"
    }

    isBind: {
      label: "Bound?\nDecision"
      style.fill: "#b2dfdb"
    }

    iFeed: {
      label: "Send to iFeed/GDW"
      style.fill: "#80cbc4"
    }

    GDWLink: {
      label: "Linked in GDW"
      style.fill: "#4db6ac"
    }
  }
}

# -------------------- DATA LAYER --------------------
DataLayer: {
  direction: right
  grid-columns: 6
  style.fill: "#e3f2fd"

  GDMS: {
    label: "GDMS\n(Document Repo)"
    shape: cylinder
    style.fill: "#90caf9"
  }

  MDM: {
    label: "MDM\n(Account Master)"
    shape: cylinder
    style.fill: "#81d4fa"
  }

  RDM: {
    label: "RDM\n(PUC Reference)"
    shape: cylinder
    style.fill: "#81d4fa"
  }

  NGPLS: {
    label: "NGPLS\n(Producer Licensing)"
    shape: cylinder
    style.fill: "#81d4fa"
  }

  GDW: {
    label: "GDW\n(Post-Bind System)"
    shape: cylinder
    style.fill: "#81d4fa"
  }

  ExternalSources: {
    label: "External APIs\n(Google, Yelp, DOL)"
    shape: cylinder
    style.fill: "#b3e5fc"
  }
}

# -------------------- FLOWS (ALL ARROWS BELOW) --------------------

ProcessFlow.BrokerActor -> ProcessFlow.BrokerDocs: "Submit Docs"
ProcessFlow.BrokerDocs -> ProcessFlow.PreReservation.InboxSweep: "Broker sends email"
ProcessFlow.PreReservation.InboxSweep -> ProcessFlow.PreReservation.EmailPull: "Trigger sweep"
ProcessFlow.PreReservation.EmailPull -> ProcessFlow.PreReservation.DocClassification: "Parse attachments"
ProcessFlow.PreReservation.DocClassification -> ProcessFlow.PreReservation.FieldExtraction: "Classify"
OntologyLayer.VectorStore -> ProcessFlow.PreReservation.FieldExtraction: "Enriched Field Match"
ProcessFlow.PreReservation.FieldExtraction -> ProcessFlow.PreReservation.ExternalEnrichment: "Enrich"
DataLayer.ExternalSources -> ProcessFlow.PreReservation.ExternalEnrichment: "Query API"
ProcessFlow.PreReservation.ExternalEnrichment -> ProcessFlow.PreReservation.GLMSDecisionCheck: "Pass augmented fields"
ProcessFlow.PreReservation.GLMSDecisionCheck -> ProcessFlow.PreReservation.LowConfidence: "If low confidence"
ProcessFlow.PreReservation.LowConfidence -> ProcessFlow.PreReservation.SSCReview: "Manual review"
ProcessFlow.PreReservation.GLMSDecisionCheck -> ProcessFlow.PreReservation.NGEReservation: "Valid submission"
DataLayer.MDM -> ProcessFlow.PreReservation.NGEReservation: "Account Lookup"
DataLayer.RDM -> ProcessFlow.PreReservation.NGEReservation: "PUC Map"
DataLayer.NGPLS -> ProcessFlow.PreReservation.NGEReservation: "Producer Validation"
DataLayer.GDMS -> ProcessFlow.PreReservation.EmailPull: "Source documents"
ProcessFlow.PreReservation.NGEReservation -> ProcessFlow.PreReservation.WWIPPrefill: "To WWIP"
ProcessFlow.PreReservation.WWIPPrefill -> ProcessFlow.Reservation.SSCValidation: "Send to SSC"
ProcessFlow.Reservation.SSCValidation -> ProcessFlow.Reservation.ReadyForUW: "Ready for UW"
ProcessFlow.Reservation.ReadyForUW -> ProcessFlow.PostReservation.Prioritization: "Score trigger"
ProcessFlow.PostReservation.Prioritization -> ProcessFlow.PostReservation.FastTrackCheck: "Evaluate"
ProcessFlow.PostReservation.FastTrackCheck -> ProcessFlow.PostReservation.UWAConsole: "Display queue"
ProcessFlow.PostReservation.UWAConsole -> ProcessFlow.PostReservation.GLMSHandoff: "Trigger if CAT"
ProcessFlow.PostReservation.GLMSHandoff -> ProcessFlow.PostReservation.GLMSResults: "Return results"
ProcessFlow.PostReservation.GLMSResults -> ProcessFlow.PostReservation.WorksheetGen: "Generate worksheet"
ProcessFlow.PostReservation.UWAConsole -> ProcessFlow.PostReservation.FollowUpReingest: "Capture follow-up"
ProcessFlow.PostReservation.FollowUpReingest -> ProcessFlow.PreReservation.FieldExtraction: "Rerun"
ProcessFlow.PostReservation.UWAConsole -> ProcessFlow.PostReservation.UWReview: "Manual review"
ProcessFlow.PostReservation.UWReview -> ProcessFlow.PostReservation.isBind: "Decision"
ProcessFlow.PostReservation.isBind -> ProcessFlow.PostReservation.iFeed: "Push to iFeed"
ProcessFlow.PostReservation.iFeed -> ProcessFlow.PostReservation.GDWLink: "Log to GDW"
ProcessFlow.PostReservation.GDWLink -> DataLayer.GDW: "Store Record"

ProcessFlow.SSActor -> ProcessFlow.PreReservation.SSCReview: "SSC assigned"
ProcessFlow.SSActor -> ProcessFlow.Reservation.SSCValidation: "SSC validates"
ProcessFlow.UWActor -> ProcessFlow.PostReservation.UWAConsole: "UW accesses queue"
ProcessFlow.UWActor -> ProcessFlow.PostReservation.UWReview: "Final review"
ProcessFlow.UWActor -> ProcessFlow.PostReservation.GLMSHandoff: "Start modeling"
ProcessFlow.COEActor -> ProcessFlow.PostReservation.GLMSResults: "Send output"
